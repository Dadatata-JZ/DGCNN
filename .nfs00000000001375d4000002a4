#! /bin/bash

data="${1}"
I=${2}
GPU=${3}
fileName="result"${I}"/${data}/testAcc"
#save="result${I}"
save="result"
common="-nonlinear tanh -gpu ${GPU} -trainRatio 0.9 -valRatio 0 -shareConv -sumNodeFeatures"
rm result/${data}/testAcc*
echo $common
echo ${fileName}
echo "A new run" >> $fileName
start=`date +%s`
#for i in $(seq ${I} ${I})  # to run individual cv split
for i in $(seq 1 10)  # to run all random cv splits in one time
do
  for j in $(seq 1 10)
  do
    echo "...............$j..............."
    case ${data} in
    DD)
      th main1.lua -dataName DD -maxNodeLabel 89 -learningRate 1e-5 -fixed_shuffle "${i}_${j}" -maxEpoch 400 -save "${save}" $common -outputChannels '89 89 89 89'

    ;;
    MUTAG)
      th main1.lua  -maxNodeLabel 7 -learningRate 1e-4 -fixed_shuffle "${i}_${j}" -maxEpoch 300 -save "${save}" $common -outputChannels '7 7 7 7'

    ;;
    ptc)
      th main1.lua -dataName ptc -maxNodeLabel 22 -learningRate 1e-4 -fixed_shuffle "${i}_${j}" -maxEpoch 300 -save "${save}" $common -outputChannels '22 22 22 22'

    ;;
    NCI1)
      th main1.lua -dataName NCI1 -maxNodeLabel 37 -learningRate 1e-4 -fixed_shuffle "${i}_${j}" -maxEpoch 400 -save "${save}" $common -outputChannels '37 37 37 37'

    ;;
    proteins)
      th main1.lua -dataName proteins -maxNodeLabel 3 -learningRate 1e-5 -fixed_shuffle "${i}_${j}" -maxEpoch 300 -save "${save}" $common -outputChannels '3 3 3 3'
    ;;
    COLLAB)
      th main1.lua -dataName COLLAB -nClass 3 -learningRate 1e-4 -fixed_shuffle "${i}_${j}" -maxEpoch 300 -save "${save}" $common -outputChannels '1 1 1 1' -nodeLabel nDegree -k 130
    ;;
    IMDBBINARY)
      th main1.lua -dataName IMDBBINARY -learningRate 1e-4 -fixed_shuffle "${i}_${j}" -maxEpoch 500 -save "${save}" $common -nodeLabel nDegree -k 31 -outputChannels '32 32 32 1'
    ;;
    IMDBMULTI)
      th main1.lua -dataName IMDBMULTI -nClass 3 -learningRate 1e-4 -fixed_shuffle "${i}_${j}" -maxEpoch 500 -save "${save}" $common -outputChannels '32 32 32 1' -nodeLabel nDegree -k 22
    ;;
    *) echo 'Dataset does not exist.'
    ;;
    esac
    #$cmd
  done
done
stop=`date +%s`
echo "The total running time is $[stop - start] seconds."
echo "The accuracy results for ${data} are as follows:"
#tail -n 10 ${fileName}
tail -n 100 ${fileName}
#echo $cmd
